<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ subject }}</title>
</head>
<body style="margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; background-color: #f5f5f5;">
    
    <!-- Email Container -->
    <table role="presentation" style="width: 100%; border-collapse: collapse; background-color: #f5f5f5;">
        <tr>
            <td align="center" style="padding: 40px 20px;">
                
                <!-- Main Content -->
                <table role="presentation" style="width: 100%; max-width: 600px; border-collapse: collapse; background-color: #ffffff; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    
                    <!-- Header -->
                    <tr>
                        <td style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 30px; text-align: center;">
                            <h1 style="margin: 0; color: #ffffff; font-size: 28px; font-weight: bold;">
                                üìä Tesla News Briefing
                            </h1>
                            <p style="margin: 10px 0 0 0; color: #ffffff; opacity: 0.9; font-size: 14px;">
                                {{ report_date }} | {{ time_period }}
                            </p>
                        </td>
                    </tr>
                    
                    <!-- Sentiment Dashboard -->
                    <tr>
                        <td style="padding: 30px; background-color: #f8f9fa;">
                            <table role="presentation" style="width: 100%; border-collapse: collapse;">
                                <tr>
                                    <td style="width: 33.33%; padding: 10px; text-align: center;">
                                        <div style="background: {% if avg_sentiment > 0.3 %}#d4edda{% elif avg_sentiment < -0.3 %}#f8d7da{% else %}#fff3cd{% endif %}; padding: 15px; border-radius: 8px;">
                                            <div style="font-size: 24px; font-weight: bold; color: {% if avg_sentiment > 0.3 %}#155724{% elif avg_sentiment < -0.3 %}#721c24{% else %}#856404{% endif %};">
                                                {{ avg_sentiment_display }}
                                            </div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">Sentiment</div>
                                        </div>
                                    </td>
                                    <td style="width: 33.33%; padding: 10px; text-align: center;">
                                        <div style="background: #e8f4f8; padding: 15px; border-radius: 8px;">
                                            <div style="font-size: 24px; font-weight: bold; color: #2980b9;">
                                                {{ avg_impact_display }}/5
                                            </div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">Avg Impact</div>
                                        </div>
                                    </td>
                                    <td style="width: 33.33%; padding: 10px; text-align: center;">
                                        <div style="background: #e8e8e8; padding: 15px; border-radius: 8px;">
                                            <div style="font-size: 24px; font-weight: bold; color: #333;">
                                                {{ total_articles }}
                                            </div>
                                            <div style="font-size: 12px; color: #666; margin-top: 5px;">Articles</div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                            
                            <!-- Stance Distribution -->
                            <table role="presentation" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <tr>
                                    <td style="width: 33.33%; padding: 5px; text-align: center;">
                                        <span style="font-size: 18px;">üêÇ</span>
                                        <div style="font-size: 14px; color: #28a745; font-weight: bold;">{{ bullish_count }}</div>
                                        <div style="font-size: 11px; color: #666;">Bullish</div>
                                    </td>
                                    <td style="width: 33.33%; padding: 5px; text-align: center;">
                                        <span style="font-size: 18px;">üêª</span>
                                        <div style="font-size: 14px; color: #dc3545; font-weight: bold;">{{ bearish_count }}</div>
                                        <div style="font-size: 11px; color: #666;">Bearish</div>
                                    </td>
                                    <td style="width: 33.33%; padding: 5px; text-align: center;">
                                        <span style="font-size: 18px;">‚ûñ</span>
                                        <div style="font-size: 14px; color: #6c757d; font-weight: bold;">{{ neutral_count }}</div>
                                        <div style="font-size: 11px; color: #666;">Neutral</div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    
                    <!-- Executive Summary -->
                    <tr>
                        <td style="padding: 30px;">
                            <h2 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 20px; border-bottom: 2px solid #e74c3c; padding-bottom: 10px;">
                                üìù Executive Summary
                            </h2>
                            <div style="color: #555; line-height: 1.6; font-size: 15px;">
                                {{ executive_summary|safe }}
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Market Outlook -->
                    <tr>
                        <td style="padding: 0 30px 30px 30px;">
                            <h2 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px;">
                                üìà Market Outlook
                            </h2>
                            <div style="color: #555; line-height: 1.6; font-size: 15px;">
                                {{ market_outlook|safe }}
                            </div>
                        </td>
                    </tr>
                    
                    <!-- Key Takeaways -->
                    <tr>
                        <td style="padding: 0 30px 30px 30px;">
                            <h2 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 20px; border-bottom: 2px solid #2ecc71; padding-bottom: 10px;">
                                üí° Key Takeaways
                            </h2>
                            <ul style="margin: 0; padding-left: 20px; color: #555; line-height: 1.8;">
                                {% for takeaway in key_takeaways %}
                                <li style="margin-bottom: 8px;">{{ takeaway }}</li>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>
                    
                    <!-- Top Stories -->
                    <tr>
                        <td style="padding: 0 30px 30px 30px;">
                            <h2 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 20px; border-bottom: 2px solid #f39c12; padding-bottom: 10px;">
                                üî• Top Stories
                            </h2>
                            {% for article in top_articles %}
                            <div style="background: #f8f9fa; padding: 15px; margin-bottom: 10px; border-left: 4px solid {% if article.stance == 'bullish' %}#28a745{% elif article.stance == 'bearish' %}#dc3545{% else %}#6c757d{% endif %}; border-radius: 4px;">
                                <div style="margin-bottom: 8px;">
                                    <a href="{{ article.url }}" style="color: #2c3e50; text-decoration: none; font-weight: bold; font-size: 16px;">
                                        {{ article.title }}
                                    </a>
                                    <span style="display: inline-block; margin-left: 8px; padding: 2px 8px; background: {% if article.stance == 'bullish' %}#28a745{% elif article.stance == 'bearish' %}#dc3545{% else %}#6c757d{% endif %}; color: white; font-size: 10px; border-radius: 3px; text-transform: uppercase;">
                                        {% if article.stance == 'bullish' %}üêÇ Bullish{% elif article.stance == 'bearish' %}üêª Bearish{% else %}‚ûñ Neutral{% endif %}
                                    </span>
                                </div>
                                <div style="font-size: 13px; color: #666; margin-bottom: 8px;">
                                    Impact: {{ '‚òÖ' * article.impact_score }}{{ '‚òÜ' * (5 - article.impact_score) }} | 
                                    Sentiment: {{ "%.2f"|format(article.sentiment_score) }}
                                </div>
                                <div style="font-size: 14px; color: #555; font-style: italic;">
                                    {{ article.summary }}
                                </div>
                            </div>
                            {% endfor %}
                        </td>
                    </tr>
                    
                    <!-- Reddit Community Buzz -->
                    {% if top_reddit_posts %}
                    <tr>
                        <td style="padding: 0 30px 30px 30px;">
                            <h2 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 20px; border-bottom: 2px solid #ff6b6b; padding-bottom: 10px;">
                                üî• Top Reddit Posts (This Week)
                            </h2>
                            {% for post in top_reddit_posts %}
                            <div style="background: #fff8e1; padding: 20px; margin-bottom: 15px; border-radius: 8px; border-left: 4px solid #ff9800;">
                                <div style="margin-bottom: 10px;">
                                    <a href="{{ post.post_url }}" style="color: #e74c3c; text-decoration: none; font-size: 18px; font-weight: bold;">
                                        {{ loop.index }}. {{ post.title }}
                                    </a>
                                </div>
                                <div style="color: #666; font-size: 14px; margin-bottom: 8px;">
                                    <span style="margin-right: 15px;">üë§ u/{{ post.author_username or 'Unknown' }}</span>
                                    <span style="margin-right: 15px;">‚¨ÜÔ∏è {{ post.upvote_count or 0 }} upvotes</span>
                                    <span>üí¨ {{ post.comment_count or 0 }} comments</span>
                                </div>
                                {% if post.text %}
                                <div style="color: #555; line-height: 1.5; font-size: 14px; margin-top: 10px;">
                                    {{ post.text[:200] }}{% if post.text|length > 200 %}...{% endif %}
                                </div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </td>
                    </tr>
                    {% endif %}
                    
                    <!-- Action Items -->
                    <tr>
                        <td style="padding: 0 30px 30px 30px;">
                            <h2 style="margin: 0 0 15px 0; color: #2c3e50; font-size: 20px; border-bottom: 2px solid #9b59b6; padding-bottom: 10px;">
                                üéØ Action Items
                            </h2>
                            <ul style="margin: 0; padding-left: 20px; color: #555; line-height: 1.8;">
                                {% for action in action_items %}
                                <li style="margin-bottom: 8px;">{{ action }}</li>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>
                    
                    <!-- View Full Report Button -->
                    <tr>
                        <td style="padding: 0 30px 30px 30px; text-align: center;">
                            <a href="{{ report_url }}" style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #ffffff; text-decoration: none; border-radius: 5px; font-weight: bold;">
                                üìä View Full Report
                            </a>
                        </td>
                    </tr>
                    
                    <!-- Footer -->
                    <tr>
                        <td style="padding: 20px 30px; background-color: #2c3e50; color: #ffffff; text-align: center; font-size: 12px;">
                            <p style="margin: 0 0 10px 0;">
                                Tesla Sentiment News Agent | Powered by AI
                            </p>
                            <p style="margin: 0; opacity: 0.7;">
                                This email was automatically generated from {{ total_articles }} news sources
                            </p>
                        </td>
                    </tr>
                    
                </table>
                
            </td>
        </tr>
    </table>
    
</body>
</html>

